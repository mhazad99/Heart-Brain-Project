function WriteOutputFile(header,  baseFileName, data, destinationFolder)
%WriteOutputFile 

% Store processing information in CSV file.
inputFileName = header(1,:);
disp(sprintf('Processing file: %s', inputFileName));

splitName = split(baseFileName,'.');
baseFileName = char(splitName(1));
outputFileName = strcat(destinationFolder,filesep,char(baseFileName),'.EDF.xml');
disp(sprintf('Generating file: %s\n', outputFileName));

% Create XML file corresponding to data file.
xmlString = '<?xml version="1.0" encoding="utf-8"?>';
prefix = '<CMPStudyConfig><EpochLength>30</EpochLength><StepChannels><StepChannel><Input>Position</Input><Labels><Label>Front</Label><Label>Back</Label><Label>Left</Label><Label>Right</Label></Labels></StepChannel><StepChannel><Input>STAT</Input><Labels><Label>GOOD</Label><Label>MARGINAL</Label><Label>POOR</Label><Label>SEN_OFF</Label></Labels></StepChannel></StepChannels><ScoredEventSettings><ScoredEventSetting><Name>Central Apnea</Name><Colour>16689645</Colour><TextColour>4194304</TextColour><Input>Abdominal</Input></ScoredEventSetting><ScoredEventSetting><Name>Obstructive Apnea</Name><Colour>16628921</Colour><TextColour>4194304</TextColour><Input>Abdominal</Input></ScoredEventSetting><ScoredEventSetting><Name>Mixed Apnea</Name><Colour>16577711</Colour><TextColour>4194304</TextColour><Input>Abdominal</Input></ScoredEventSetting><ScoredEventSetting><Name>SpO2 desaturation</Name><Colour>9342719</Colour><TextColour>4194304</TextColour><Input>SaO2</Input></ScoredEventSetting><ScoredEventSetting><Name>Respiratory artifact</Name><Colour>10406345</Colour><TextColour>4194304</TextColour><Input>Abdominal</Input></ScoredEventSetting><ScoredEventSetting><Name>SpO2 artifact</Name><Colour>10406345</Colour><TextColour>4194304</TextColour><Input>SaO2</Input></ScoredEventSetting><ScoredEventSetting><Name>Arousal (ASDA)</Name><Colour>11206589</Colour><TextColour>4194304</TextColour><Input>C3</Input></ScoredEventSetting><ScoredEventSetting><Name>Arousal (ASDA)</Name><Colour>11206589</Colour><TextColour>4194304</TextColour><Input>C4</Input></ScoredEventSetting><ScoredEventSetting><Name>Arousal (ARO Limb)</Name><Colour>11206589</Colour><TextColour>4194304</TextColour><Input>Leg L</Input></ScoredEventSetting><ScoredEventSetting><Name>Arousal (ARO Limb)</Name><Colour>11206589</Colour><TextColour>4194304</TextColour><Input>Leg R</Input></ScoredEventSetting><ScoredEventSetting><Name>Arousal ()</Name><Colour>11206589</Colour><TextColour>4194304</TextColour></ScoredEventSetting><ScoredEventSetting><Name>PLM (Left)</Name><Colour>0</Colour><TextColour>0</TextColour><Input>Leg L</Input></ScoredEventSetting><ScoredEventSetting><Name>Limb Movement (Left)</Name><Colour>0</Colour><TextColour>0</TextColour><Input>Leg L</Input></ScoredEventSetting><ScoredEventSetting><Name>PLM (Right)</Name><Colour>0</Colour><TextColour>0</TextColour><Input>Leg R</Input></ScoredEventSetting><ScoredEventSetting><Name>Limb Movement (Right)</Name><Colour>0</Colour><TextColour>0</TextColour><Input>Leg R</Input></ScoredEventSetting><ScoredEventSetting><Name>Bradycardia</Name><Colour>16744576</Colour><TextColour>0</TextColour><Input>ECG L</Input></ScoredEventSetting><ScoredEventSetting><Name>Tachycardia</Name><Colour>16744576</Colour><TextColour>0</TextColour><Input>ECG L</Input></ScoredEventSetting><ScoredEventSetting><Name>TcCO2 artifact</Name><Colour>10406345</Colour><TextColour>4194304</TextColour></ScoredEventSetting><ScoredEventSetting><Name>EtCO2 artifact</Name><Colour>10406345</Colour><TextColour>4194304</TextColour></ScoredEventSetting><ScoredEventSetting><Name>Distal pH artifact</Name><Colour>10406345</Colour><TextColour>4194304</TextColour></ScoredEventSetting><ScoredEventSetting><Name>Distal pH</Name><Colour>8454143</Colour><TextColour>0</TextColour></ScoredEventSetting><ScoredEventSetting><Name>Proximal pH artifact</Name><Colour>10406345</Colour><TextColour>4194304</TextColour></ScoredEventSetting><ScoredEventSetting><Name>Proximal pH artifact</Name><Colour>8454143</Colour><TextColour>0</TextColour></ScoredEventSetting><ScoredEventSetting><Name>Blood pressure artifact</Name><Colour>10406345</Colour><TextColour>4194304</TextColour></ScoredEventSetting><ScoredEventSetting><Name>Body temperature artifact</Name><Colour>10406345</Colour><TextColour>4194304</TextColour></ScoredEventSetting><ScoredEventSetting><Name>Unsure</Name><Colour>11337727</Colour><TextColour>0</TextColour><Input>Abdominal</Input></ScoredEventSetting><ScoredEventSetting><Name>Respiratory Paradox</Name><Colour>16711808</Colour><TextColour>0</TextColour><Input>Thoracic</Input></ScoredEventSetting><ScoredEventSetting><Name>Periodic Breathing</Name><Colour>16711808</Colour><TextColour>0</TextColour><Input>Airflow</Input></ScoredEventSetting><ScoredEventSetting><Name>Periodic Breathing</Name><Colour>10406345</Colour><TextColour>4194304</TextColour><Input>Abdominal</Input></ScoredEventSetting><ScoredEventSetting><Name>Obstructive Hypopnea</Name><Colour>16117971</Colour><TextColour>4194304</TextColour><Input>Abdominal</Input></ScoredEventSetting><ScoredEventSetting><Name>Hypopnea</Name><Colour>16117971</Colour><TextColour>4194304</TextColour><Input>Abdominal</Input></ScoredEventSetting><ScoredEventSetting><Name>Central Hypopnea</Name><Colour>16117971</Colour><TextColour>4194304</TextColour><Input>Abdominal</Input></ScoredEventSetting><ScoredEventSetting><Name>Hypopnea</Name><Colour>16117971</Colour><TextColour>4194304</TextColour><Input>Abdominal</Input></ScoredEventSetting><ScoredEventSetting><Name>Mixed Hypopnea</Name><Colour>16117971</Colour><TextColour>4194304</TextColour><Input>Abdominal</Input></ScoredEventSetting><ScoredEventSetting><Name>Hypopnea</Name><Colour>16117971</Colour><TextColour>4194304</TextColour><Input>Abdominal</Input></ScoredEventSetting><ScoredEventSetting><Name>RERA</Name><Colour>11206589</Colour><TextColour>4194304</TextColour><Input>Abdominal</Input></ScoredEventSetting></ScoredEventSettings><SleepStages>';
suffix = '</SleepStages><Montage><TracePanes><TracePane><BkColour>14546935</BkColour><Timebase>30</Timebase><BkColour>14155478</BkColour><Timebase>120</Timebase><Traces><Trace><Colour>8388736</Colour><HighPass>0.3</HighPass><Input>LOC</Input><Ref></Ref><LowerLimit>-125.000005937181</LowerLimit><LowPass>35</LowPass><Notch>0</Notch><NumGridLines>0</NumGridLines><RelativeSize>1</RelativeSize><UpperLimit>125.000005937181</UpperLimit><Zoom>2</Zoom></Trace><Trace><Colour>8388736</Colour><HighPass>0.3</HighPass><Input>ROC</Input><Ref></Ref><LowerLimit>-125.000005937181</LowerLimit><LowPass>35</LowPass><Notch>0</Notch><NumGridLines>0</NumGridLines><RelativeSize>1</RelativeSize><UpperLimit>125.000005937181</UpperLimit><Zoom>2</Zoom></Trace><Trace><Colour>32768</Colour><HighPass>10</HighPass><Input>L Chin</Input><Ref>R Chin</Ref><LowerLimit>-31.2500014842954</LowerLimit><LowPass>63</LowPass><Notch>0</Notch><NumGridLines>0</NumGridLines><RelativeSize>1</RelativeSize><UpperLimit>31.2500014842954</UpperLimit><Zoom>8</Zoom></Trace><Trace><Colour>0</Colour><HighPass>0.3</HighPass><Input>C3</Input><Ref>A2</Ref><LowerLimit>-50.0000023748726</LowerLimit><LowPass>35</LowPass><Notch>0</Notch><NumGridLines>0</NumGridLines><RelativeSize>1</RelativeSize><UpperLimit>50.0000023748726</UpperLimit><Zoom>5</Zoom></Trace><Trace><Colour>0</Colour><HighPass>0.3</HighPass><Input>C4</Input><Ref>A1</Ref><LowerLimit>-50.0000023748726</LowerLimit><LowPass>35</LowPass><Notch>0</Notch><NumGridLines>0</NumGridLines><RelativeSize>1</RelativeSize><UpperLimit>50.0000023748726</UpperLimit><Zoom>5</Zoom></Trace><Trace><Colour>248</Colour><HighPass>1</HighPass><Input>ECG L</Input><Ref>ECG R</Ref><LowerLimit>-0.500000023748726</LowerLimit><LowPass>35</LowPass><Notch>0</Notch><NumGridLines>0</NumGridLines><RelativeSize>1</RelativeSize><UpperLimit>0.500000023748726</UpperLimit><Zoom>2</Zoom></Trace><Trace><Colour>248</Colour><HighPass>0</HighPass><Input>HR</Input><Ref></Ref><LowerLimit>0</LowerLimit><LowPass>0</LowPass><Notch>0</Notch><NumGridLines>0</NumGridLines><RelativeSize>1</RelativeSize><UpperLimit>255</UpperLimit><Zoom>1</Zoom></Trace><Trace><Colour>32768</Colour><HighPass>20</HighPass><Input>Leg L</Input><Ref></Ref><LowerLimit>-2.49999994412065</LowerLimit><LowPass>30</LowPass><Notch>0</Notch><NumGridLines>0</NumGridLines><RelativeSize>1</RelativeSize><UpperLimit>2.49999994412065</UpperLimit><Zoom>2</Zoom></Trace><Trace><Colour>32768</Colour><HighPass>20</HighPass><Input>Leg R</Input><Ref></Ref><LowerLimit>-2.49999994412065</LowerLimit><LowPass>30</LowPass><Notch>0</Notch><NumGridLines>0</NumGridLines><RelativeSize>1</RelativeSize><UpperLimit>2.49999994412065</UpperLimit><Zoom>2</Zoom></Trace><Trace><Colour>16285824</Colour><HighPass>0.15</HighPass><Input>Airflow</Input><Ref></Ref><LowerLimit>-0.100000004749745</LowerLimit><LowPass>5</LowPass><Notch>0</Notch><NumGridLines>0</NumGridLines><RelativeSize>1</RelativeSize><UpperLimit>0.100000004749745</UpperLimit><Zoom>10</Zoom></Trace><Trace><Colour>16285824</Colour><HighPass>0.05</HighPass><Input>Cannula Flow</Input><Ref></Ref><LowerLimit>-0.025</LowerLimit><LowPass>5</LowPass><Notch>0</Notch><NumGridLines>0</NumGridLines><RelativeSize>1</RelativeSize><UpperLimit>0.025</UpperLimit><Zoom>20</Zoom></Trace><Trace><Colour>16252928</Colour><HighPass>0.05</HighPass><Input>Thoracic</Input><Ref></Ref><LowerLimit>-0.499999988824129</LowerLimit><LowPass>5</LowPass><Notch>0</Notch><NumGridLines>0</NumGridLines><RelativeSize>1</RelativeSize><UpperLimit>0.499999988824129</UpperLimit><Zoom>10</Zoom></Trace><Trace><Colour>16252928</Colour><HighPass>0.05</HighPass><Input>Abdominal</Input><Ref></Ref><LowerLimit>-0.499999988824129</LowerLimit><LowPass>5</LowPass><Notch>0</Notch><NumGridLines>0</NumGridLines><RelativeSize>1</RelativeSize><UpperLimit>0.499999988824129</UpperLimit><Zoom>10</Zoom></Trace><Trace><Colour>8388608</Colour><HighPass>0.05</HighPass><Input>SUM</Input><Ref></Ref><LowerLimit>-0.499999988824129</LowerLimit><LowPass>5</LowPass><Notch>0</Notch><NumGridLines>0</NumGridLines><RelativeSize>1</RelativeSize><UpperLimit>0.499999988824129</UpperLimit><Zoom>10</Zoom></Trace><Trace><Colour>248</Colour><HighPass>0</HighPass><Input>SaO2</Input><Ref></Ref><LowerLimit>0</LowerLimit><LowPass>0</LowPass><Notch>0</Notch><NumGridLines>0</NumGridLines><RelativeSize>1</RelativeSize><UpperLimit>100</UpperLimit><Zoom>1</Zoom></Trace><Trace><Colour>0</Colour><HighPass>0</HighPass><Input>STAT</Input><Ref></Ref><LowerLimit>0</LowerLimit><LowPass>0</LowPass><Notch>0</Notch><NumGridLines>0</NumGridLines><RelativeSize>1</RelativeSize><UpperLimit>3</UpperLimit><Zoom>1</Zoom></Trace><Trace><Colour>128</Colour><HighPass>0</HighPass><Input>Position</Input><Ref></Ref><LowerLimit>0</LowerLimit><LowPass>0</LowPass><Notch>0</Notch><NumGridLines>0</NumGridLines><RelativeSize>1</RelativeSize><UpperLimit>3</UpperLimit><Zoom>1</Zoom></Trace></Traces></TracePane></TracePanes></Montage></CMPStudyConfig>';
openTag = '<SleepStage>';
closeTag = '</SleepStage>';
dataString = '';

% Create XML data string
nbDataValues = length(data);
for i=1:nbDataValues
   valueString = sprintf('%s%d%s',openTag,data(i),closeTag);
   dataString = strcat(dataString,valueString);
end   
completeString = sprintf('%s\n%s%s%s',xmlString,prefix,dataString,suffix);

% Write strings to XML file
fid = fopen(outputFileName,'W');
fprintf(fid,'%s',completeString);
fclose(fid);

end % End of WriteOutputFile

